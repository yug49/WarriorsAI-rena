import { toUtf8Bytes, toUtf8String } from "ethers/src.ts/utils/utf8";

import { Typed } from "ethers/src.ts/abi/typed";
import { DynamicBytesCoder } from "ethers/src.ts/abi/coders/bytes";

import type { Reader, Writer } from "ethers/src.ts/abi/coders/abstract-coder";


/**
 *  @_ignore
 */
export class StringCoder extends DynamicBytesCoder {

    constructor(localName: string) {
        super("string", localName);
    }

    defaultValue(): string {
        return "";
    }

    encode(writer: Writer, _value: string | Typed): number {
        return super.encode(writer, toUtf8Bytes(Typed.dereference(_value, "string")));
    }

    decode(reader: Reader): any {
        return toUtf8String(super.decode(reader));
    }
}
